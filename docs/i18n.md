# 多语言支持 (i18n)

## 功能概述

应用已添加中英文双语支持,用户可以在设置页面切换界面语言。

## 实现细节

### 1. 语言检测
- 首次启动时,自动检测操作系统语言
- 如果系统语言为中文(zh-*),默认使用简体中文(zh-CN)
- 否则使用英语(en)

### 2. 语言切换
- 在设置页面的"其他"部分添加了语言选择下拉框
- 支持的语言:
  - 简体中文 (zh-CN)
  - English (en)
- 切换语言后立即生效,并保存到设置文件

### 3. 语言持久化
- 语言设置保存在 `settings.json` 的 `language` 字段
- 下次启动时自动加载用户选择的语言

### 4. 翻译覆盖范围
- 导航菜单
- 所有页面标题和描述
- 表单标签和占位符
- 按钮文本
- 对话框标题和按钮
- 状态提示信息
- 向导内容
- 错误和成功消息

## 文件结构

```
frontend/src/
├── i18n.js                 # 多语言核心模块
├── app.js                  # 更新对话框和环境状态使用i18n
├── main.js                 # 初始化i18n
└── pages/
    └── settings.js         # 添加语言选择器
```

## 使用方法

### 在代码中使用翻译

```javascript
// 获取翻译文本
const text = I18n.t('settings.title');

// 在HTML中使用
container.innerHTML = `<h2>${I18n.t('settings.title')}</h2>`;

// 使用data-i18n属性(自动更新)
<span data-i18n="nav.sample">样本分析</span>
```

### 添加新的翻译

在 `frontend/src/i18n.js` 的 `translations` 对象中添加:

```javascript
const translations = {
    'zh-CN': {
        'your.key': '中文文本',
    },
    'en': {
        'your.key': 'English text',
    }
};
```

## 技术实现

### I18n 对象

```javascript
const I18n = {
    currentLang: 'zh-CN',           // 当前语言
    init(),                         // 初始化,加载语言设置
    loadLanguage(),                 // 从设置加载语言
    t(key),                         // 获取翻译文本
    setLanguage(lang),              // 切换语言
    updateUI()                      // 更新UI中的所有翻译
};
```

### 自动更新机制

- 使用 `data-i18n` 属性标记需要翻译的元素
- 使用 `data-i18n-placeholder` 属性标记需要翻译的占位符
- 调用 `I18n.updateUI()` 自动更新所有标记的元素

## 后端支持

### Go Model 更新

在 `internal/model/model.go` 中添加了 `Language` 字段:

```go
type Settings struct {
    // ... 其他字段
    Language string `json:"language,omitempty"` // "zh-CN" or "en"
}
```

## 测试

1. 启动应用,检查默认语言是否为操作系统语言
2. 进入设置页面,切换语言
3. 验证所有页面的文本是否正确切换
4. 重启应用,验证语言设置是否保持

## 未来扩展

如需添加更多语言:

1. 在 `translations` 对象中添加新语言的翻译
2. 在设置页面的语言选择器中添加新选项
3. 更新语言检测逻辑(如需要)
